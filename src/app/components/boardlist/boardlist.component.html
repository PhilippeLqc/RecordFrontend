<div class="boardlist-main">
  <button (click)="openCreateListModal()" [hidden]="showCreateListModal">
    + Créer une nouvelle liste
  </button>
  <form [formGroup]="boardlistForm" (ngSubmit)="onSubmitBoardlist($event)" [hidden]="!showCreateListModal">
    <div class="form-group">
      <mat-form-field appearance="outline">
        <mat-label>Enter the boardlist name</mat-label>
        <input matInput placeholder="Name of Boardlist" formControlName="boardlistName" required />
      </mat-form-field>
    </div>
    <div class="buttongroup">
      <button mat-raised-button type="submit" class="flat" (click)="openCreateListModal()">
        Create new boardlist
      </button>
    </div>
  </form>
  <div class="boardlist-container" cdkDropListGroup>
    @for (boardlist of boardlistsProject; track boardlist) {
    <div>
      <div class="boardlist" cdkDropList [id]="boardlist.id.toString()" [cdkDropListData]="tasks[boardlist.id]"
        (cdkDropListDropped)="drop($event)">

        <div class="boardlist-title">
          @if (boardlistIdFormName != boardlist.id) {
          <h2 (click)="showBoardlistNameFormFn(boardlist.id)">{{ boardlist.name }}</h2>
          }
          @if (boardlistIdFormName == boardlist.id) {
          <input #boardlistNameInput [value]="boardlist.name"
            (blur)="updateBoardlistName(boardlist, boardlistNameInput.value, boardlist.id)"
            (keyup.enter)="updateBoardlistName(boardlist, boardlistNameInput.value, boardlist.id)" autofocus />
          }
          <div class="relative">
            @if (showBoardlistMenu != boardlist.id) {
            <button (click)="showEditBoardlistMenu(boardlist.id)">Show Menu</button>
            }
            @if (showBoardlistMenu == boardlist.id) {
              <button (click)="showBoardlistMenu = -1">Show Menu</button>

              <div class="absolute bg-white border rounded shadow p-2 mt-2">
                <button (click)="editFromBoardlistMenu(boardlist.id)">Edit</button>
                <button (click)="deleteFromBoardlistMenu(boardlist.id)">Delete</button>
              </div>
            }
          </div>
        </div>
        @for ( task of tasks[boardlist.id]; track task) {
        <div cdkDrag>
          <h3>{{ task.title }}</h3>
          <!-- <p>{{ task.description }}</p> -->
          <button (click)="openUpdateModal(task.taskId)">+</button>

        </div>
        }
        <button (click)="openModal(boardlist.id)">créer une tâche</button>
        @if (!showUpdate) {
          <app-modal [show]="showModal" (closeEvent)="closeModal()">
            <app-task
              [boardlistId]="selectedBoardlistId"
              [tasks]="tasks[selectedBoardlistId]"
              [taskIdFromBoardlist]="selectedTask"
              (taskCreated)="closeModal()"></app-task>
          </app-modal>
        }
        @if (showUpdate) {
          <app-modal [show]="showModal" (closeEvent)="closeModal()">
            <p>Hello</p>
          </app-modal>
        }

      </div>
    </div>
    }
  </div>
</div>